/* RUI: REA User Interface library - Core - v6.5.0
   Copyright 2016, REA Group */

!function(a,b){"function"==typeof define&&define.amd?define("rui-social",["jquery"],function(a){return b(a)}):(a.RUI=a.RUI||{},a.RUI.Social=b(a.jQuery))}(this,function(a){function b(){e.FACEBOOK_TEMPLATE="http://www.facebook.com/sharer/sharer.php?s=100&p[url]={{url}}&p[title]={{title}}&p[summary]={{summary}}",e.TWITTER_TEMPLATE="https://twitter.com/intent/tweet?url={{url}}&text={{title}}&via=realestate_au",e.PINTEREST_TEMPLATE="http://pinterest.com/pin/create/button/?url={{url}}&media={{media}}&description={{summary}}",e.GOOGLEPLUS_TEMPLATE="https://plus.google.com/share?url={{url}}",e.LINKEDIN_TEMPLATE="https://www.linkedin.com/shareArticle?mini=true&url={{url}}&summary={{summary}}&title={{title}}",e.FACEBOOK_API="http://graph.facebook.com/{{url}}",e.TWITTER_API="http://urls.api.twitter.com/1/urls/count.json?url={{url}}",e.PINTEREST_API="http://api.pinterest.com/v1/urls/count.json?url={{url}}",e.LINKEDIN_API="http://www.linkedin.com/countserv/count/share?url={{url}}",e.FACEBOOK_SHARE_COUNT_FIELD="shares",e.TWITTER_SHARE_COUNT_FIELD="count",e.PINTEREST_SHARE_COUNT_FIELD="count",e.LINKEDIN_SHARE_COUNT_FIELD="count"}function c(b,c,d){a.ajax({url:b,dataType:"jsonp"}).success(function(a){var b=a[d]||0;c.append('<span class="rui-share-counter">'+b+"</span>")})}function d(a,b){window.open(a,b,"height=260,width=570,left=100,top=100,resizable=no,scrollbars=no,toolbar=no,menubar=no,location=no,directories=no,status=no")}var e=function(){this.list=a(".rui-social")};return b(),e.prototype.generateLink=function(b){var c=a(b),d=c.data("service"),f=e[d.toUpperCase()+"_TEMPLATE"];if(f){var g=encodeURIComponent(c.data("url")||this.getHref()||""),h=encodeURIComponent(c.data("media")||""),i=encodeURIComponent(c.data("title")||document.title||""),j=encodeURIComponent(c.data("description")||a('meta[name="description"]').attr("content")||""),k=f.replace(/{{url}}/g,g).replace(/{{title}}/g,i).replace(/{{summary}}/g,j).replace(/{{media}}/g,h);if("facebook"===d&&c.attr("data-images")){var l=c.attr("data-images").split(",");a.each(l,function(b,c){k+="&p[images]["+b+"]="+a.trim(encodeURIComponent(c))})}return{url:k,title:d}}},e.prototype.getCounter=function(){var b=this;this.list.each(function(){var d=a(this).find("[data-service]"),f=d.data("showCounter");if(f){var g=d.data("service");if("googleplus"!==g){var h=e[g.toUpperCase()+"_API"].replace(/{{url}}/g,encodeURIComponent(d.data("url")||b.getHref())),i=e[g.toUpperCase()+"_SHARE_COUNT_FIELD"];c(h,a(this),i)}else a(this).append('<span class="rui-share-counter">0</span>')}})},e.prototype.getHref=function(){return window.location.href},e.prototype.bindEvents=function(){var b=this;a("body").on("click",".rui-social > .rui-icon",function(){var a=b.generateLink(this);d(a.url,a.title)})},a(function(){var a=new e;a.bindEvents(),a.getCounter()}),e});